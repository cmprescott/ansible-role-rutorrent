# ansible-role-rutorrent/tasks/main.yml
---
- name: check for current installation
  stat: "path={{ rutorrent_dir_install }}/conf"
  register: rutorrent_conf

- name: download rutorrent src
  get_url:
    url: "{{ rutorrent_download_url }}"
    dest: "{{ rutorrent_download_dest }}"
  when: not rutorrent_conf.stat.exists

- name: ensure install directory exists
  sudo: Yes
  file:
    path: "{{ rutorrent_dir_install }}"
    state: directory
  when: not rutorrent_conf.stat.exists

- name: ensure untarred files to install directory
  sudo: Yes
  command: tar xvf {{ rutorrent_download_dest }} -C {{ rutorrent_dir_install }} --strip-components=1
  args:
    creates: "{{ rutorrent_dir_install }}/conf"
  when: not rutorrent_conf.stat.exists

- name: ensure we have bin locations set by template
  sudo: Yes
  template:
    src: config.php.j2
    dest: "{{ rutorrent_dir_install }}/conf/config.php"

- name: ensure www-data owns all files in install directory
  sudo: Yes
  file:
    path: "{{ rutorrent_dir_install }}"
    state: directory
    group: "{{ rutorrent_dir_install_group }}"
    owner: "{{ rutorrent_dir_install_owner }}"
    recurse: Yes
...
