---
# tasks file for ansible-role-rutorrent

# -------------
# Download/install dependency programs
# -------------
- name: ensure unzip, unrar, curl present
  sudo: Yes
  apt: >
    name={{ item }}
    state=present
  with_items:
   - unzip
   - unrar
   - curl

# -------------
# Download, install, & config  RUTorrent
# -------------
- name: ensure downloaded ruTorrent
  sudo: No
  get_url: >
    url={{ rutorrent_url_download }}rutorrent-{{ rutorrent_version }}.tar.gz
    dest={{ rutorrent_directory_src_download }}
  

- name: ensure untarred files to {{ rutorrent_directory_install }}
  sudo: Yes
  command: >
    sudo tar xvf {{ rutorrent_directory_src_download }}rutorrent-{{ rutorrent_version }}.tar.gz -C {{ rutorrent_directory_install }}rutorrent
    creates={{ rutorrent_directory_install }}rutorrent
  

- name: ensure www-data owns ruTorrent application
  sudo: Yes
  file: >
    path={{ rutorrent_directory_install }}rutorrent
    state=directory
    group={{ rutorrent_directory_install_group }}
    owner={{ rutorrent_directory_install_owner }}
    recurse=yes
  

# ------------------
# Bin settings
# ------------------
- name: ensure we have bin locations set by template
  sudo: Yes
  template: >
    src=config.php.j2
    dest={{ rutorrent_directory_install }}rutorrent/conf/config.php
    